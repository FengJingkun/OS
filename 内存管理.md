## 程序重定位

程序编译后生成可执行文件，其中用到的地址都是**逻辑地址**。可执行文件被载入物理内存后，需要根据**物理基址将逻辑地址转换成实际的物理地址**。这就是**程序重定位。**

- **编译时重定位**

  程序编译时进行重定位，但程序运行时载入的物理内存位置不固定，因此无法适用于日常的PC机上。

- **载入时重定位**

  程序载入时，根据载入的物理地址来修改程序中的逻辑地址，进而实现重定位。但在进程换入换出后，先前修改的地址就会失效，导致进程无法正常工作。

- **运行时重定位**

  在指令执行前完成逻辑地址到物理地址的转换。即**每执行一条指令，就将指令中的逻辑地址加上当前的物理基址以后再放到地址总线上。**由于每条指令都要进行地址转换，因此该过程由**硬件实现，即内存管理单元MMU。**

OS中往往运行着多个进程，每个进程被载入到不同的物理内存区域，因此拥有不同的物理基址。这些物理基址保存在PCB中，进程切换时从PCB中取出并赋值给基址寄存器。随后，MMU利用该寄存器完成**地址转换。**

**基址对应于一段内存空间，基址的切换实际上就是一段内存空间的切换。与线程切换相比，进程切换实际上只是多了地址空间的切换。**